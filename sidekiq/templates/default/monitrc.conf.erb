<% (@worker_count || 1).times do |num| %>

<% sidekiq_config_file = @deploy[:sidekiq_config_file] ||= 'config/sidekiq.yml' %>

check process sidekiq_<%= @app_name %>_<%= num %>
  with pidfile <%= @deploy[:deploy_to] %>/shared/pids/sidekiq<%= num %>.pid
  start program = "/usr/bin/sudo su - deploy -c 'cd <%= @deploy[:deploy_to] %>/current; RAILS_ENV=<%= @deploy[:rails_env] %> bundle exec sidekiq -d -C <%= sidekiq_config_file %> -P <%= @deploy[:deploy_to] %>/shared/pids/sidekiq<%= num %>.pid -L log/sidekiq.log'" with timeout 90 seconds
  stop program = "/usr/bin/sudo su - deploy -c '/bin/kill -9 `cat <%= @deploy[:deploy_to] %>/shared/pids/sidekiq<%= num %>.pid`'" with timeout 180 seconds
  group sidekiq_<%= @app_name %>
<% end %>
